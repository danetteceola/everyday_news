## Context

Everyday News系统每天从5个平台采集约500条新闻数据，需要从这些海量信息中提取关键热点，生成简洁、有洞察力的每日总结。人工处理这些数据效率低下且难以保证一致性，而AI大语言模型能够快速分析、归纳和总结。

当前项目处于规划阶段，已有详细的总结生成设计文档（docs/03-summary-generation.md），包含总结模板、触发方式和质量控制策略。需要选择合适的技术栈实现AI总结功能，并考虑成本、性能和可靠性。

## Goals / Non-Goals

**Goals:**
1. 实现智能AI总结生成，自动分析新闻数据并提取关键热点
2. 提供标准化的总结模板，确保输出格式一致性和专业性
3. 深度集成Claude Skill，提供良好的开发和使用体验
4. 支持多种触发方式，满足不同使用场景需求
5. 确保总结质量，包括准确性、完整性和合规性

**Non-Goals:**
1. 不实现复杂的多模型集成（Claude/DeepSeek足够）
2. 不提供实时流式总结（每日批量总结足够）
3. 不实现复杂的个性化定制（标准模板足够）
4. 不处理需要人工审核的敏感内容（自动总结公开内容）

## Decisions

### 1. LLM服务选择
**选择**: Claude API（主要） + DeepSeek（备选）
**理由**:
- Claude提供了强大的总结和分析能力，适合新闻内容处理
- DeepSeek作为成本更低的备选方案，平衡性能和成本
- 通过OpenRouter统一接口，支持多模型切换
- Claude Code Router提供良好的开发集成体验
**替代方案考虑**:
- 考虑过GPT-4，但成本较高且API限制较多
- 考虑过开源模型本地部署，但硬件要求和维护成本较高
- 考虑过多个模型混合使用，但复杂度较高

### 2. 总结模板设计
**选择**: 结构化模板 + AI自由发挥
**理由**:
- 固定模板部分确保基本结构和关键信息完整性
- AI生成部分提供灵活性和洞察力
- 模板支持变量替换和条件逻辑
- 输出格式标准化便于后续处理和展示
**替代方案考虑**:
- 考虑过完全自由格式，但输出一致性难以保证
- 考虑过完全固定模板，但缺乏灵活性和洞察力

### 3. Claude Skill集成
**选择**: 创建daily-summary Claude Skill
**理由**:
- 封装总结生成逻辑，提供清晰的接口
- 支持技能参数配置和模板管理
- 便于在Claude Code环境中使用和测试
- 支持技能版本管理和更新
**替代方案考虑**:
- 考虑过直接API调用，但集成度和开发体验较差
- 考虑过自定义命令行工具，但使用便利性不如Claude Skill

### 4. 触发机制设计
**选择**: 定时触发 + 手动触发 + API触发
**理由**:
- 定时触发（每天10:00, 22:00）满足常规需求
- 手动触发支持临时需求和测试
- API触发支持外部系统集成和自动化
- 多种触发方式覆盖不同使用场景
**替代方案考虑**:
- 考虑过事件驱动触发，但当前需求复杂度不高
- 考虑过纯定时触发，但灵活性不足

### 5. 质量控制策略
**选择**: 多层质量控制机制
**理由**:
- 输入数据验证：确保总结数据完整有效
- 输出长度控制：限制token使用，控制成本
- 关键信息检查：验证总结包含必要信息
- 合规性检查：确保内容符合法律法规
- 降级方案：AI失败时使用模板生成基础总结
**替代方案考虑**:
- 考虑过人工审核，但成本高且效率低
- 考虑过纯AI信任，但风险较高

## Risks / Trade-offs

### 风险1: AI生成内容质量不稳定
- **风险**: AI生成总结质量波动，可能遗漏重要信息或产生错误
- **缓解**: 模板约束，关键信息验证，人工抽查，降级方案

### 风险2: API成本控制
- **风险**: LLM API使用成本可能超出预期
- **缓解**: Token限制，缓存机制，成本监控，备选低成本模型

### 风险3: API服务可用性
- **风险**: LLM API服务不可用导致总结生成失败
- **缓解**: 多模型备选，请求重试，降级模板，服务监控

### 风险4: 内容合规风险
- **风险**: AI生成内容可能违反法律法规或平台政策
- **缓解**: 内容过滤，关键词检查，合规模板，免责声明

### 权衡: 总结质量 vs 生成成本
- **选择**: 平衡质量和成本，优先关键信息准确性
- **理由**: 新闻总结需要准确性，但成本也需要控制
- **代价**: 可能需要更复杂的提示工程和模板设计

### 权衡: 灵活性 vs 一致性
- **选择**: 模板提供一致性，AI提供灵活性
- **理由**: 需要保证基本格式一致性，同时允许AI发挥创造力
- **代价**: 模板设计需要平衡结构和自由度

## Migration Plan

### 部署步骤
1. **环境准备**: 配置Claude API/DeepSeek API密钥，安装Claude Code Router
2. **模板系统部署**: 部署总结模板和变量系统
3. **AI引擎集成**: 集成LLM API客户端和提示工程
4. **Claude Skill开发**: 开发daily-summary Claude Skill
5. **触发机制实现**: 实现定时、手动、API触发
6. **质量控制系统**: 实现质量控制和安全检查
7. **监控和优化**: 配置监控告警，优化提示和模板

### 回滚策略
- 保留旧版本模板和技能配置
- 关键操作记录详细日志，便于问题排查
- 支持快速切换到模板降级模式

## Open Questions

1. **模型选择策略**: 何时使用Claude vs DeepSeek？基于内容复杂度还是成本？
2. **总结缓存策略**: 相同输入是否应该缓存AI响应？缓存有效期多长？
3. **个性化定制**: 是否需要支持用户自定义总结模板或偏好？
4. **多语言支持**: 是否需要支持英文或其他语言总结生成？